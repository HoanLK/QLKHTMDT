admin.controller("accountController",["$scope","$http","$cookies","$window","$location",function(n,t,i,r){function h(){var i=angular.element("#idUser").val();t.get("/API/AccountAPI/"+i).then(function(i){n.currentUser={Id:i.data.Id,UserName:i.data.UserName,Email:i.data.Email,TenNguoiDung:i.data.TenNguoiDung,PhoneNumber:i.data.PhoneNumber,DonVi_ID:i.data.DonVi_ID,Fax:i.data.Fax,IsQuyenKhachHang:i.data.IsQuyenKhachHang,KhachHang_ID:i.data.KhachHang_ID,PhoneNumber:i.data.PhoneNumber};t.get("/Account/GetRoleByAccount/"+n.currentUser.Id).then(function(t){n.currentUser.Role=t.data;s(u);c()},function(){toastr.error("Không lấy được quyền Account")})},function(){toastr.error("Không lấy được thông tin Account")})}function s(i){t.get("/Account/GetAccountByRole?RoleId="+i).then(function(t){n.accounts=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách Account")})}function c(){t.get(e).then(function(t){n.donvis=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách Đơn vị")})}var u,f,e,o;n.currentUser={};u="khachhang";n.accounts=[];n.account={};n.selectedAccounts=[];f="/API/AccountAPI";n.donvis=[];e="/API/DonViAPI";n.modifyAccount=!1;n.titlePopupModifyAccount="Sửa thông tin tài khoản";n.popupModifyAccount={width:"auto",height:"auto",contentTemplate:"templateModifyAccount",showTitle:!0,resizeEnabled:!0,bindingOptions:{title:"titlePopupModifyAccount",visible:"modifyAccount"}};n.controlModifyAccount={tenNguoiDung:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"account.TenNguoiDung"}},dienthoai:{showClearButton:!0,valueChangeEvent:"keyup",bindingOptions:{value:"account.DienThoai"}},donvi:{displayExpr:"DonVi_Name",valueExpr:"DonVi_ID",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"donvis",value:"account.DonVi_ID"}},addDonVi:{icon:"plus",onClick:function(){n.AddDonVi()}}};n.deleteAccount=!1;n.titleDeleteAccount="Bạn có chắc chắn muốn xóa?";n.popupDeleteAccount={width:"auto",height:"auto",contentTemplate:"templateDeleteAccount",showTitle:!1,bindingOptions:{visible:"deleteAccount"}};n.gridAccounts={bindingOptions:{dataSource:"accounts","columns[4].lookup.dataSource":"donvis"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"ID",dataField:"Id",dataType:"string",visible:!1},{alignment:"left",caption:"Tên người dùng",dataField:"TenNguoiDung",dataType:"string"},{alignment:"left",caption:"Email",dataField:"Email",dataType:"string"},{alignment:"left",caption:"Điện thoại",dataField:"PhoneNumber",dataType:"string"},{caption:"Đơn vị",dataField:"DonVi_ID",lookup:{displayExpr:"DonVi_Name",valueExpr:"DonVi_ID"}},{caption:"Xác nhận Email",dataField:"EmailConfirmed",dataType:"boolean"},{caption:"Bảo mật 2 lớp",dataField:"TwoFactor",dataType:"boolean"}],columnResizingMode:"widget",editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Người dùng",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"id",summaryType:"count"}],totalItems:[{column:"id",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.AddAccount()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.EditAccount()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.DeleteAccount()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){GetAllAccount()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.account=angular.copy(t.data),n.EditAccount()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedAccounts=angular.copy(t.selectedRowsData)}};o=[{value:"add",text:" Thêm",icon:"fa fa-plus"},{value:"edit",text:" Sửa",icon:"fa fa-pencil"},{value:"delete",text:" Xóa",icon:"fa fa-times"}];n.contextMenuAccounts={dataSource:o,width:100,target:"#account",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddAccount();break;case"edit":n.EditAccount();break;case"delete":n.DeleteAccount()}}};h();n.AddAccount=function(){r.location.href="/Account/Register"};n.EditAccount=function(){n.selectedAccounts.length==0?toastr.error("Chọn 1 dòng để sửa"):(n.account=angular.copy(n.selectedAccounts[0]),n.modifyAccount=!0)};n.SaveAccount=function(){t.get(f+"/"+n.account.Id).then(function(i){var r=i.data;r.TenNguoiDung=n.account.TenNguoiDung;r.DienThoai=n.account.DienThoai;r.DonVi_ID=n.account.DonVi_ID;t.put(f+"/"+r.Id,r).then(function(){s(u);toastr.success("Thành công","Sửa");n.modifyAccount=!1},function(){toastr.error("Thất bại","Sửa")})},function(){toastr.error("Thất bại","Sửa")})};n.CancelSaveAccount=function(){n.modifyAccount=!1};n.DeleteAccount=function(){n.selectedAccounts.length==0?toastr.error("Chọn dòng để xóa"):n.deleteAccount=!0};n.ConfirmDeleteAccount=function(){n.account=angular.copy(n.selectedAccounts[0]);r.location.href="/Account/Delete/"+n.account.Id;n.deleteAccount=!1};n.CancelDeleteAccount=function(){n.deleteAccount=!1}}]);