admin.controller("infoUserSidebarController",["$scope","$http","$cookies","$window","$location",function(n,t){function i(){var i=angular.element("#idUser").val();t.get("/API/AccountAPI/"+i).then(function(i){n.currentUser={Id:i.data.Id,UserName:i.data.UserName,Email:i.data.Email,TenNguoiDung:i.data.TenNguoiDung,PhoneNumber:i.data.PhoneNumber,DonVi_ID:i.data.DonVi_ID,Fax:i.data.Fax,KhachHang_ID:i.data.KhachHang_ID,PhoneNumber:i.data.PhoneNumber};t.get("/Account/GetRoleByAccount/"+n.currentUser.Id).then(function(t){n.currentUser.Role=t.data;console.log(n.currentUser);r();u()},function(){toastr.error("Không lấy được quyền DonHang")})},function(){toastr.error("Không lấy được thông tin DonHang")})}function r(){var i=null;n.currentUser.Role=="khachhang"?i=n.currentUser.Id:n.currentUser.Role=="nhanvien"&&(i=n.currentUser.KhachHang_ID);t.get("/API/DonHangAPI?att=KhachHang&&value="+i).then(function(t){n.donhangs=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách đơn hàng")})}function u(){t.get(apiTinhThanhPho).then(function(t){n.tinhthanhphos=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách Tỉnh - Thành phố")})}n.currentUser={};i();n.AddDonHang=function(){t.get("/KhoSo/GetSoHieuChuaCap").then(function(t){n.donhang={SoHieu:t.data.SoHieu,Ngay:new Date,ThoiGianTaoDonHang:new Date,TrangThai:"CHUACHOT"};n.currentUser.Role=="khachhang"?n.donhang.KhachHang_ID=n.currentUser.Id:n.currentUser.Role=="nhanvien"&&(n.donhang.KhachHang_ID=n.currentUser.KhachHang_ID,n.donhang.NhanVien_ID=n.currentUser.Id);n.titlePopupModifyDonHang="Thêm đơn hàng";n.modifyDonHang=!0;n.postDonHang=!0},function(){toastr.error("Không lấy được Số hiệu")})};n.EditDonHang=function(){n.selectedDonHangs.length==0?toastr.error("Chọn 1 dòng để sửa"):(n.donhang=angular.copy(n.selectedDonHangs[0]),n.modifyDonHang=!0)};n.SaveDonHang=function(){n.postDonHang==!0?t.post(apiDonHang,n.donhang).then(function(i){n.donhangs.push(i.data);t.get("/KhoSo/XacNhanCap/"+n.donhang.SoHieu).then(function(t){t.data==1?(toastr.success("Thành công","Thêm"),n.modifyDonHang=!1,n.postDonHang=!1):toastr.error("Không cập nhật được Kho số")},function(){toastr.error("Không cập nhật được Kho số")})},function(){toastr.error("Thất bại","Thêm")}):t.put(apiDonHang+"/"+n.donhang.SoHieu,n.donhang).then(function(){angular.forEach(n.donhangs,function(t,i){t.SoHieu==n.donhang.SoHieu&&(n.donhangs[i]=angular.copy(n.donhang),toastr.success("Thành công","Sửa"),n.modifyDonHang=!1)})},function(){toastr.error("Thất bại","Sửa")})};n.CancelSaveDonHang=function(){n.modifyDonHang=!1};n.DeleteDonHang=function(){n.selectedDonHangs.length==0?toastr.error("Chọn dòng để xóa"):n.deleteDonHang=!0};n.ConfirmDeleteDonHang=function(){angular.forEach(n.selectedDonHangs,function(i){t.delete(apiDonHang+"/"+i.SoHieu).then(function(){angular.forEach(n.donhangs,function(r,u){i.SoHieu===r.SoHieu&&(n.donhangs.splice(u,1),t.get("/KhoSo/HuyCap/"+i.SoHieu).then(function(n){n.data==1||toastr.error("Không cập nhật được Kho số")},function(){toastr.error("Không cập nhật được Kho số")}))})},function(){toastr.error("Không xóa được")})});toastr.success("Thành công","Xóa");n.deleteDonHang=!1};n.CancelDeleteDonHang=function(){n.deleteDonHang=!1}}]);