admin.controller("chotDonHangController",["$scope","$http","$cookies","$window","$location",function(n,t,i,r){function h(){var i=angular.element("#idUser").val();t.get("/API/AccountAPI/"+i).then(function(i){n.currentUser={Id:i.data.Id,UserName:i.data.UserName,Email:i.data.Email,TenNguoiDung:i.data.TenNguoiDung,PhoneNumber:i.data.PhoneNumber,DonVi_ID:i.data.DonVi_ID,Fax:i.data.Fax,KhachHang_ID:i.data.KhachHang_ID,PhoneNumber:i.data.PhoneNumber};t.get("/Account/GetRoleByAccount/"+n.currentUser.Id).then(function(t){n.currentUser.Role=t.data;switch(n.currentUser.Role){case"nhanvienbuudien":r.location.href="/DonHang/XacNhanDonHang";break;case"nhanvien":r.location.href="/DonHang/QuanLyDonHang"}f();c();l()},function(){toastr.error("Không lấy được quyền Người dùng")})},function(){toastr.error("Không lấy được thông tin Người dùng")})}function f(){t.get("/API/ChotDonHangAPI?att=KhachHang&&value="+n.currentUser.KhachHang_ID).then(function(t){n.chotDonHangs=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách đơn hàng")})}function c(){t.get(e).then(function(t){n.tinhthanhphos=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách Tỉnh - Thành phố")})}function l(){t.get("/Account/GetNhanVienChotDonByKhachHang/"+n.currentUser.KhachHang_ID).then(function(t){n.nhanviens=angular.copy(t.data)},function(){toastr.error("Không lấy được danh sách Nhân viên")})}function s(){t.get("/APi/DonHangAPI?att=KhachHangChuaCoTrongChiTietChot&&value="+n.chotDonHang.KhachHang_ID).then(function(t){n.donhangChuaChots=angular.copy(t.data)},function(){toastr.error("Không lấy được đơn chưa chốt")})}function a(){t.get("/API/DonHangAPI?att=ChotDonHang&&value="+n.chotDonHang.ChotDonHang_ID).then(function(t){n.donhangChots=angular.copy(t.data)},function(){toastr.error("Không lấy được chi tiết phiếu chốt")})}var u,e,o;n.currentUser={};n.chotDonHangs=[];n.chotDonHang={};n.selectedChotDonHangs=[];u="/API/ChotDonHangAPI";n.donhangChuaChots=[];n.donhangChuaChot={};n.selectedDonHangChuaChots=[];n.donhangChots=[];n.donhangChot={};n.selectedDonHangChots=[];n.tinhthanhphos=[];e="/API/TinhThanhPhoAPI";n.nhanviens=[];n.trangthaiChotDons=[{value:"CHUACHOT",text:"Chưa chốt"},{value:"DACHOT",text:"Đã chốt"}];n.trangthaiXacNhanDons=[{value:"CHUAXACNHAN",text:"Chưa xác nhận"},{value:"DAXACNHAN",text:"Đã xác nhận"}];n.createChotDonHang=!1;n.popupCreateChotDonHang={width:"auto",height:"auto",contentTemplate:"templateCreateChotDonHang",showTitle:!0,resizeEnabled:!0,fullScreen:!1,title:"Chốt đơn hàng",bindingOptions:{visible:"createChotDonHang"}};n.postChotDonHang=!1;n.modifyChotDonHang=!1;n.titlePopupModifyChotDonHang="Chốt đơn hàng";n.popupModifyChotDonHang={width:"auto",height:"auto",contentTemplate:"templateModifyChotDonHang",showTitle:!0,resizeEnabled:!0,fullScreen:!0,bindingOptions:{title:"titlePopupModifyChotDonHang",visible:"modifyChotDonHang"}};n.controlModifyChotDonHang={thoigianChotDonHang:{type:"datetime",applyButtonText:"Xong",cancelButtonText:"Hủy",displayFormat:"dd/MM/yyyy HH:mm",bindingOptions:{value:"chotDonHang.ThoiGianChotDonHang"}},ngay:{type:"date",displayFormat:"dd/MM/yyyy",bindingOptions:{value:"chotDonHang.Ngay"}},trangthaiChotDon:{displayExpr:"text",valueExpr:"value",searchEnabled:!0,noDataText:"Không có dữ liệu",placeholder:"Chọn ...",bindingOptions:{items:"trangthaiChotDons",value:"chotDonHang.TrangThaiChotDonHang"}}};n.deleteChotDonHang=!1;n.titleDeleteChotDonHang="Bạn có chắc chắn muốn xóa?";n.popupDeleteChotDonHang={width:"auto",height:"auto",contentTemplate:"templateDeleteChotDonHang",showTitle:!1,bindingOptions:{visible:"deleteChotDonHang"}};n.gridChotDonHangs={bindingOptions:{dataSource:"chotDonHangs","columns[1].lookup.dataSource":"trangthaiChotDons","columns[3].lookup.dataSource":"trangthaiXacNhanDons"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"ID",dataField:"ChotDonHang_ID",dataType:"string"},{caption:"Trạng thái chốt đơn",dataField:"TrangThaiChotDonHang",lookup:{displayExpr:"text",valueExpr:"value"},allowFiltering:!0},{alignment:"left",caption:"Thời gian chốt đơn",dataField:"ThoiGianChotDonHang",dataType:"date",format:"dd/MM/yyyy HH:mm",customizeText:function(n){return n.valueText}},{caption:"Trạng thái xác nhận",dataField:"TrangThaiXacNhanDonHang",lookup:{displayExpr:"text",valueExpr:"value"},allowFiltering:!0},{alignment:"left",caption:"Thời gian xác nhận",dataField:"ThoiGianXacNhanDonHang",dataType:"date",format:"dd/MM/yyyy HH:mm",customizeText:function(n){return n.valueText}},],columnResizingMode:"widget",editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!0,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Danh sách Chốt đơn",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Kéo một cột vào đây để nhóm theo cột đó",visible:!1},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"ChotDonHang_ID",summaryType:"count"}],totalItems:[{column:"ChotDonHang_ID",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Thêm",icon:"add",type:"success",onClick:function(){n.AddChotDonHang()}}},{location:"after",widget:"dxButton",options:{hint:"Sửa",icon:"edit",type:"default",onClick:function(){n.EditChotDonHang()}}},{location:"after",widget:"dxButton",options:{hint:"Xóa",icon:"trash",type:"danger",onClick:function(){n.DeleteChotDonHang()}}},{location:"after",widget:"dxButton",options:{hint:"Load lại Dữ liệu",icon:"refresh",onClick:function(){f()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.chotDonHang=angular.copy(t.data),n.EditChotDonHang()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedChotDonHangs=angular.copy(t.selectedRowsData)}};n.gridDonHangChuaChots={bindingOptions:{dataSource:"donhangChuaChots","columns[1].lookup.dataSource":"trangthaiChotDons","columns[5].lookup.dataSource":"tinhthanhphos","columns[10].lookup.dataSource":"nhanviens","columns[11].lookup.dataSource":"nhanviens"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"Số hiệu",dataField:"SoHieu",dataType:"string"},{caption:"Trạng thái",dataField:"TrangThai",lookup:{displayExpr:"text",valueExpr:"value"},allowFiltering:!1,visible:!1},{alignment:"left",caption:"Người nhận",dataField:"NguoiNhan",dataType:"string"},{alignment:"left",caption:"SĐT người nhận",dataField:"SoDienThoaiNguoiNhan",dataType:"string"},{alignment:"left",caption:"Địa chỉ người nhận",dataField:"DiaChiNguoiNhan",dataType:"string"},{caption:"Tỉnh - Thành phố",dataField:"TinhThanhPho_ID",lookup:{displayExpr:"TinhThanhPho_Name",valueExpr:"TinhThanhPho_ID"}},{alignment:"right",caption:"Số tiền thu hộ",dataField:"SoTienThuHo",format:{type:"fixedPoint",precision:0}},{alignment:"left",caption:"Loại hàng",dataField:"LoaiHang_Name",dataType:"string"},{alignment:"right",caption:"Số lượng",dataField:"SoLuong",format:{type:"fixedPoint",precision:0}},{alignment:"left",caption:"Thời gian tạo đơn",dataField:"ThoiGianTaoDonHang",dataType:"date",format:"dd/MM/yyyy HH:mm",customizeText:function(n){return n.valueText}},{caption:"Nhân viên tạo",dataField:"NhanVien_ID",lookup:{displayExpr:"TenNguoiDung",valueExpr:"Id"}},{caption:"SĐT nhân viên",dataField:"NhanVien_ID",lookup:{displayExpr:"PhoneNumber",valueExpr:"Id"}},],columnResizingMode:"widget",editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Đơn hàng chưa chốt",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Đơn hàng chưa chốt",visible:!0},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"SoHieu",summaryType:"count"}],totalItems:[{column:"SoHieu",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{hint:"Chốt đơn",icon:"arrowright",onClick:function(){n.ThemDonHangChots()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.donhangChuaChot=angular.copy(t.data),n.ThemDonHangChot()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedDonHangChuaChots=angular.copy(t.selectedRowsData)}};n.gridDonHangChots={bindingOptions:{dataSource:"donhangChots","columns[1].lookup.dataSource":"trangthaiChotDons","columns[5].lookup.dataSource":"tinhthanhphos","columns[10].lookup.dataSource":"nhanviens","columns[11].lookup.dataSource":"nhanviens"},allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{emptyPanelText:"Kéo và thả cột muốn ẩn vào đây",enabled:!0,mode:"select",title:"Lựa chọn cột"},columnFixing:{enabled:!0,texts:{fix:"Cố định cột",leftPosition:"Bên trái",rightPosition:"Bên phải",unfix:"Hủy cố định"}},columns:[{alignment:"left",allowEditing:!1,caption:"Số hiệu",dataField:"SoHieu",dataType:"string"},{caption:"Trạng thái",dataField:"TrangThai",lookup:{displayExpr:"text",valueExpr:"value"},allowFiltering:!1,visible:!1},{alignment:"left",caption:"Người nhận",dataField:"NguoiNhan",dataType:"string"},{alignment:"left",caption:"SĐT người nhận",dataField:"SoDienThoaiNguoiNhan",dataType:"string"},{alignment:"left",caption:"Địa chỉ người nhận",dataField:"DiaChiNguoiNhan",dataType:"string"},{caption:"Tỉnh - Thành phố",dataField:"TinhThanhPho_ID",lookup:{displayExpr:"TinhThanhPho_Name",valueExpr:"TinhThanhPho_ID"}},{alignment:"right",caption:"Số tiền thu hộ",dataField:"SoTienThuHo",format:{type:"fixedPoint",precision:0}},{alignment:"left",caption:"Loại hàng",dataField:"LoaiHang_Name",dataType:"string"},{alignment:"right",caption:"Số lượng",dataField:"SoLuong",format:{type:"fixedPoint",precision:0}},{alignment:"left",caption:"Thời gian tạo đơn",dataField:"ThoiGianTaoDonHang",dataType:"date",format:"dd/MM/yyyy HH:mm",customizeText:function(n){return n.valueText}},{caption:"Nhân viên tạo",dataField:"NhanVien_ID",lookup:{displayExpr:"TenNguoiDung",valueExpr:"Id"}},{caption:"SĐT nhân viên",dataField:"NhanVien_ID",lookup:{displayExpr:"PhoneNumber",valueExpr:"Id"}},],columnResizingMode:"widget",editing:{mode:"cell",allowAdding:!1,allowDeleting:!1,allowUpdating:!1,texts:{addRow:"Thêm",cancelAllChanges:"Không thay đổi",cancelRowChanges:"Hủy",confirmDeleteMessage:"Bạn có chắc chắn muốn xóa?",deleteRow:"Xóa",editRow:"Sửa",saveAllChanges:"Lưu thay đổi",saveRowChanges:"Lưu",undeleteRow:"Không xóa",validationCancelChanges:"Hủy thay đổi"}},"export":{allowExportSelectedData:!0,enabled:!1,excelFilterEnabled:!0,excelWrapTextEnabled:!0,fileName:"Đơn hàng đã chốt",texts:{exportAll:"Xuất toàn bộ Dữ liệu",exportSelectedRows:"Xuất dữ liệu đang chọn",exportTo:"Trích xuất"}},filterRow:{applyFilterText:"Áp dụng bộ lọc",betweenEndText:"Kết thúc",betweenStartText:"Bắt đầu",resetOperationText:"Thiết lập lại",showAllText:"(Tất cả)",visible:!0},grouping:{contextMenuEnabled:!0,expandMode:"rowClick",texts:{groupByThisColumn:"Nhóm theo Cột này",groupContinuedMessage:"Tiếp tục từ trang trước",groupContinuesMessage:"Tiếp tục trên các trang tiếp theo",ungroup:"Bỏ nhóm",ungroupAll:"Bỏ tất cả nhóm"}},groupPanel:{emptyPanelText:"Đơn hàng chưa chốt",visible:!0},headerFilter:{texts:{cancel:"Hủy",emptyValue:"(Trống)",ok:"Đồng ý"},visible:!0},hoverStateEnabled:!0,loadPanel:{enabled:!0,text:"Đang tải ..."},noDataText:"Không có dữ liệu",pager:{infoText:"Trang {0} của {1}",showInfo:!0,showNavigationButtons:!0,showPageSizeSelector:!0,visible:!0},paging:{enabled:!0,pageIndex:0,pageSize:50},remoteOperations:{grouping:!1,summary:!1},rowAlternationEnabled:!1,scrolling:{preloadEnabled:!0},searchPanel:{placeholder:"Tìm kiếm ..."},selection:{mode:"multiple",showCheckBoxesMode:"onClick"},showBorders:!0,showRowLines:!0,sorting:{ascendingText:"Sắp xếp Tăng dần",clearText:"Xóa Sắp xếp",descendingText:"Sắp xếp Giảm dần"},summary:{texts:{count:"{0}",sum:"{0}"},groupItems:[{column:"SoHieu",summaryType:"count"}],totalItems:[{column:"SoHieu",summaryType:"count"}]},wordWrapEnabled:!1,onToolbarPreparing:function(t){var i=t.component;t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{hint:"Bỏ chốt",icon:"arrowleft",onClick:function(){n.XoaDonHangChots()}}})},onRowClick:function(t){var i=t.component;i.clickCount=i.clickCount?i.clickCount+1:1;i.clickCount==1?(i.lastClickTime=new Date,setTimeout(function(){i.lastClickTime=0;i.clickCount=0},350)):i.clickCount==2&&(new Date-i.lastClickTime<300&&(n.donhangChot=angular.copy(t.data),n.XoaDonHangChot()),i.clickCount=0,i.lastClickTime=0)},onSelectionChanged:function(t){n.selectedDonHangChots=angular.copy(t.selectedRowsData)}};o=[{value:"add",text:" Thêm",icon:"fa fa-plus"},{value:"edit",text:" Sửa",icon:"fa fa-pencil"},{value:"delete",text:" Xóa",icon:"fa fa-times"}];n.contextMenuChotDonHangs={dataSource:o,width:100,target:"#chotDonHang",itemTemplate:function(n){var t=$("<div><\/div>");return n.icon&&t.append('<span class="'+n.icon+'"><span>'),t.append(n.text),t},onItemClick:function(t){if(!t.itemData.items)switch(t.itemData.value){case"add":n.AddChotDonHang();break;case"edit":n.EditChotDonHang();break;case"delete":n.DeleteChotDonHang()}}};h();n.AddChotDonHang=function(){n.createChotDonHang=!0};n.CreateChotDonHang=function(){n.chotDonHang={Ngay:new Date,ThoiGianChotDonHang:new Date,TrangThaiChotDonHang:"DACHOT",TrangThaiXacNhanDonHang:"CHUAXACNHAN",KhachHang_ID:n.currentUser.KhachHang_ID,NhanVien_ID:n.currentUser.Id,DonVi_ID:n.currentUser.DonVi_ID};s();n.donhangChots=[];n.modifyChotDonHang=!0;n.createChotDonHang=!1;n.postChotDonHang=!0};n.CancelCreateChotDonHang=function(){n.createChotDonHang=!1};n.EditChotDonHang=function(){n.selectedChotDonHangs.length==0?toastr.error("Chọn 1 dòng để sửa"):(n.chotDonHang=angular.copy(n.selectedChotDonHangs[0]),n.chotDonHang.TrangThaiXacNhanDonHang=="DAXACNHAN"?toastr.error("Phiếu chốt ĐÃ XÁC NHẬN"):(s(),a(),n.titlePopupModifyChotDonHang="Sửa phiếu chốt đơn hàng",n.modifyChotDonHang=!0))};n.SaveChotDonHang=function(){n.postChotDonHang==!0?(n.chotDonHang.Ngay.setTime(n.chotDonHang.Ngay.getTime()+252e5),n.chotDonHang.ThoiGianChotDonHang.setTime(n.chotDonHang.ThoiGianChotDonHang.getTime()+252e5),t.post(u,n.chotDonHang).then(function(i){t.get(u+"/"+i.data.ChotDonHang_ID).then(function(i){n.chotDonHang=angular.copy(i.data);var r="";angular.forEach(n.donhangChots,function(n){r+=n.SoHieu+","});t.get("/DonHang/CapNhatChiTietChotDon/?idChotDon="+n.chotDonHang.ChotDonHang_ID+"&&idDonHangs="+r).then(function(i){i.data==1?(n.chotDonHangs.push(n.chotDonHang),toastr.success("Chốt đơn thành công"),n.modifyChotDonHang=!1,n.postChotDonHang=!1):(t.delete(u+"/"+n.chotDonHang.ChotDonHang_ID).then(function(){n.modifyChotDonHang=!1;n.postChotDonHang=!1},function(){}),toastr.error("Không lưu được chi tiết"))},function(){toastr.error("Không lưu được chi tiết")})},function(){toastr.error("Không lưu được chi tiết")})},function(){toastr.error("Không lưu được")})):t.put(u+"/"+n.chotDonHang.ChotDonHang_ID,n.chotDonHang).then(function(){var i="";angular.forEach(n.donhangChots,function(n){i+=n.SoHieu+","});t.get("/DonHang/CapNhatChiTietChotDon/?idChotDon="+n.chotDonHang.ChotDonHang_ID+"&&idDonHangs="+i).then(function(t){t.data==1?angular.forEach(n.chotDonHangs,function(t,i){t.ChotDonHang_ID==n.chotDonHang.ChotDonHang_ID&&(n.chotDonHangs[i]=angular.copy(n.chotDonHang),toastr.success("Lưu thành công"),n.modifyChotDonHang=!1)}):toastr.error("Không lưu được chi tiết")},function(){toastr.error("Không lưu được chi tiết")})},function(){toastr.error("Không lưu được thay đổi")})};n.CancelSaveChotDonHang=function(){n.modifyChotDonHang=!1};n.DeleteChotDonHang=function(){if(n.selectedChotDonHangs.length==0)toastr.error("Chọn dòng để xóa");else{var t=!0;angular.forEach(n.selectedChotDonHangs,function(n){n.TrangThaiXacNhanDonHang=="DAXACNHAN"&&(t=!1)});t==!0?n.deleteChotDonHang=!0:toastr.error("Chốt đơn ĐÃ XÁC NHẬN")}};n.ConfirmDeleteChotDonHang=function(){var i="";angular.forEach(n.selectedChotDonHangs,function(n){i+=n.ChotDonHang_ID+","});t.get("/DonHang/XoaChotDonHang/"+i).then(function(n){n.data==1?(toastr.success("Xóa thành công"),f()):toastr.error("Xóa không thành công")},function(){toastr.error("Xóa không thành công")});n.deleteChotDonHang=!1};n.CancelDeleteChotDonHang=function(){n.deleteChotDonHang=!1};n.ThemDonHangChot=function(){n.donhangChuaChot.TrangThai="DACHOT";n.donhangChots.push(n.donhangChuaChot);angular.forEach(n.donhangChuaChots,function(t,i){t.SoHieu==n.donhangChuaChot.SoHieu&&(n.donhangChuaChots.splice(i,1),n.donhangChuaChot={})})};n.ThemDonHangChots=function(){angular.forEach(n.selectedDonHangChuaChots,function(t){n.donhangChuaChot=angular.copy(t);n.ThemDonHangChot()});n.selectedDonHangChuaChots=[]};n.XoaDonHangChot=function(){n.donhangChot.TrangThai="CHUACHOT";n.donhangChuaChots.push(n.donhangChot);angular.forEach(n.donhangChots,function(t,i){t.SoHieu==n.donhangChot.SoHieu&&(n.donhangChots.splice(i,1),n.donhangChot={})})};n.XoaDonHangChots=function(){console.log("Hello");angular.forEach(n.selectedDonHangChots,function(t){n.donhangChot=angular.copy(t);n.XoaDonHangChot()});n.selectedDonHangChots=[]}}]);